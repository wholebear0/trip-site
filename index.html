<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Travel Map + Trips Table</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#f2f2f2;
}

/* ================= HEADER ================= */
.header{
  background:#333;
  color:white;
  text-align:center;
  padding:20px;
}

.header h1{margin:0;font-size:32px;}
.header p{margin:5px 0 0;font-size:16px;}

/* ================= MAP ================= */
#filters{
  position:absolute;
  z-index:999;
  background:white;
  padding:10px;
  margin:10px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
}

#container{
  display:flex;
  height:80vh;
  min-height:500px;
}

#map-container{flex:3;padding:10px;}
#map{width:100%;height:100%;}

#details-panel{
  flex:1;
  background:#f9f9f9;
  padding:15px;
  overflow-y:auto;
  border-left:1px solid #ccc;
}

#details-panel img{
  width:100%;
  margin-bottom:15px;
}

.go-to-page-btn{
  background:#28a745;
  color:white;
  padding:12px;
  border:none;
  width:100%;
  font-size:18px;
  cursor:pointer;
  margin-top:15px;
}

.go-to-page-btn:hover{background:#218838;}

@media(max-width:900px){
  #container{flex-direction:column;}
  #details-panel{border-left:none;border-top:1px solid #ccc;}
}

/* ================= SPACER ================= */
.spacer{
  height:40px;
}

/* ================= TABLE ================= */
.table-section{
  padding:0 20px 40px 20px;
}

table{
  width:100%;
  border-collapse:collapse;
  background:#2b2b2b;
  font-size:12.5px;
  color:#eaeaea;
}

th,td{
  padding:8px 10px;
  border-bottom:1px solid #444;
  white-space:nowrap;
  text-align:left;
}

th{background:#3a3a3a;}

tbody tr:nth-child(odd){background:#2b2b2b;}
tbody tr:nth-child(even){background:#303030;}

tbody tr:hover{
  background:#3f3f3f!important;
  cursor:pointer;
}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  display:inline-block;
}

/* ===== MOBILE TABLE ===== */
@media(max-width:768px){

  table,thead,tbody,th,tr{display:block;}
  thead{display:none;}

  tbody tr{
    position:relative;
    margin-bottom:16px;
    background:#2b2b2b;
    border-radius:8px;
    padding:10px 130px 10px 10px;
  }

  tbody td{
    display:none;
    border:none;
    padding:3px 0;
    white-space:normal;
  }

  tbody td[data-label="Hike"],
  tbody td[data-label="Area"],
  tbody td[data-label="Miles"],
  tbody td[data-label="Gain"],
  tbody td[data-label="Date"]{
    display:flex;
    gap:6px;
  }

  tbody td::before{
    content:attr(data-label)":";
    font-weight:bold;
    color:#bbb;
    min-width:60px;
  }

  .mobile-image{
    position:absolute;
    top:0;
    right:0;
    bottom:0;
    width:120px;
    background-size:cover;
    background-position:center;
    border-radius:0 8px 8px 0;
  }
}
</style>
</head>

<body>

<div class="header">
  <h1>My Travel Map</h1>
  <p>Click a location or row to view the trip</p>
</div>

<!-- FILTER -->
<div id="filters">
  <label>
    Type:
    <select id="typeFilter">
      <option value="All">All</option>
      <option value="Hike">Hike</option>
      <option value="Backpack">Backpack</option>
      <option value="Kayak">Kayak</option>
      <option value="Other">Other</option>
    </select>
  </label>
</div>

<!-- MAP -->
<div id="container">
  <div id="map-container">
    <div id="map"></div>
  </div>

  <div id="details-panel">
    <div id="details-content">Loading...</div>
  </div>
</div>

<!-- SPACER -->
<div class="spacer"></div>

<!-- TABLE -->
<div class="table-section">
<table id="tripsTable">
<thead>
<tr>
  <th></th>
  <th>Hike</th>
  <th>Area</th>
  <th>Type</th>
  <th>Miles</th>
  <th>Gain</th>
  <th>Rank</th>
  <th>Date</th>
  <th>Year</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<script>
/* ================= CONFIG ================= */
const SCRIPT_URL =
"https://script.google.com/macros/s/AKfycby_5e7cG_REtJkwr6TPDp4oWLoi6H52u3EBswtjLmzvM1UT5bSxDKp3P4SQ5tBoMMYf/exec";

const GOOGLE_MAPS_KEY =
"AIzaSyCMCxxUBxZ-a2UyHwu5PbKwYBxvAo0bAAA";
/* ========================================== */

let map;
let allTrips=[];
let mapMarkers=[];

/* ================= MAP ================= */
function initMap(){

  map=new google.maps.Map(
    document.getElementById("map"),
    {
      center:{lat:36.805098,lng:-109.822512},
      zoom:6,
      mapTypeId:"terrain",
      gestureHandling:"greedy",
      disableDefaultUI:true
    }
  );

  loadTrips();
}

function loadTrips(){
  fetch(SCRIPT_URL)
    .then(r=>r.json())
    .then(data=>{
      allTrips=data.cardItems;
      updateMarkers();
      renderTable();
    });
}

function getMarkerIcon(type){
  switch(type?.toLowerCase()){
    case "hike": return "https://maps.google.com/mapfiles/ms/icons/blue-dot.png";
    case "backpack": return "https://maps.google.com/mapfiles/ms/icons/red-dot.png";
    case "kayak": return "https://maps.google.com/mapfiles/ms/icons/green-dot.png";
    default: return "https://maps.google.com/mapfiles/ms/icons/yellow-dot.png";
  }
}

function updateMarkers(){

  mapMarkers.forEach(m=>m.setMap(null));
  mapMarkers=[];

  const selected=
    document.getElementById("typeFilter").value;

  allTrips.forEach(d=>{

    if(selected!=="All" && d.type!==selected) return;
    if(!d.position) return;

    const marker=new google.maps.Marker({
      position:d.position,
      map,
      icon:getMarkerIcon(d.type)
    });

    marker.addListener("click",()=>showDetails(d));
    mapMarkers.push(marker);
  });
}

document
.getElementById("typeFilter")
.addEventListener("change",updateMarkers);

function showDetails(data){

  const urls=
    data.imageUrl?.split(",").map(u=>u.trim())||[];

  const imagesHtml=
    urls.map(u=>`<img src="${u}">`).join("");

  document.getElementById("details-content").innerHTML=`
    <h2>${data.title}</h2>
    ${imagesHtml}
    <p><strong>Area:</strong> ${data.area}</p>
    <p><strong>Date:</strong> ${data.date}</p>
    <p><strong>Miles:</strong> ${data.miles}</p>
    <p><strong>Elevation Gain:</strong> ${data.elevationGain}</p>
    <button class="go-to-page-btn">Go to Page</button>
  `;

  document
  .querySelector(".go-to-page-btn")
  .onclick=()=>{
    const slug=
      data.title.toLowerCase().replace(/\s+/g,'-');

    window.location.href=
      `trip-gallery.html?slug=${slug}`;
  };
}

/* ================= TABLE ================= */
function formatDate(d){
  const x=new Date(d);
  return isNaN(x)?'':
    `${x.getMonth()+1}-${x.getDate()}-${x.getFullYear()}`;
}

function getDotColor(type=''){
  return{
    hike:'#6188e6',
    backpack:'#fd7567',
    kayak:'#00e74c',
    other:'#ede562'
  }[type.toLowerCase()]||'#999';
}

function renderTable(){

  const tbody=
    document.querySelector('#tripsTable tbody');

  tbody.innerHTML='';

  allTrips
  .sort((a,b)=>new Date(b.date)-new Date(a.date))
  .forEach(item=>{

    const tr=document.createElement('tr');

    tr.innerHTML=`
      <td><span class="dot"
      style="background:${getDotColor(item.type)}"></span></td>

      <td data-label="Hike">${item.title}</td>
      <td data-label="Area">${item.area}</td>
      <td data-label="Type">${item.type}</td>
      <td data-label="Miles">${item.miles}</td>
      <td data-label="Gain">${item.elevationGain.toLocaleString()}</td>
      <td data-label="Rank">${item.overallRanking}</td>
      <td data-label="Date">${formatDate(item.date)}</td>
      <td data-label="Year">
        ${new Date(item.date).getFullYear()}
      </td>
    `;

    /* ROW CLICK â†’ TRIP PAGE */
    tr.onclick=()=>{
      const slug=
        item.title.toLowerCase().replace(/\s+/g,'-');

      window.location.href=
        `trip-gallery.html?slug=${slug}`;
    };

    /* MOBILE IMAGE */
    if(item.imageUrl){
      const img=document.createElement('div');
      img.className='mobile-image';
      img.style.backgroundImage=
        `url(${item.imageUrl})`;
      tr.appendChild(img);
    }

    tbody.appendChild(tr);
  });
}
</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMCxxUBxZ-a2UyHwu5PbKwYBxvAo0bAAA&callback=initMap">
</script>

</body>
</html>
