<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Trip Gallery</title>
<style>
body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: #f5f5f5;
}
h1 {
    text-align: center;
    margin-bottom: 20px;
    text-transform: capitalize;
}
.trip-container {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
}
.trip-info, .trip-cover, .trip-map {
    background: #fff;
    padding: 15px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    border-radius: 6px;
}
.trip-info { flex:1 1 200px; }
.trip-cover { flex:1 1 400px; text-align:center; }
.trip-cover img { width:100%; max-height:300px; object-fit:cover; border-radius:0; }
.trip-map { flex:1 1 300px; min-height:300px; }
.banner {
    margin: 20px auto;
    max-width: 1200px;
    padding: 15px;
    text-align: center;
    background-color: #444;
    color: #fff;
    font-size: 18px;
}
.photos-container {
    margin: 20px auto;
    max-width: 1200px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    align-items: center;
}
.photos-container img {
    width: 90%;
    max-width: 800px;
    border-radius: 0;
    object-fit: cover;
    loading: lazy;
}
@media(max-width:900px){
    .trip-container { flex-direction: column; }
    .trip-info, .trip-cover, .trip-map { min-width:100%; }
}
</style>
</head>
<body>

<h1 id="trip-title">Loading...</h1>

<div class="trip-container">
    <div class="trip-info" id="trip-info"></div>
    <div class="trip-cover" id="trip-cover"></div>
    <div class="trip-map" id="trip-map"></div>
</div>

<div class="banner">Your small banner text goes here</div>

<div class="photos-container" id="photos-container"></div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwoUNNQZsKfLkEYcc4DfyVQkzuc3BGGXd-DDV0dAfMHhhE5i_FY3Bq5z8PBUhg2teot/exec";
const params = new URLSearchParams(window.location.search);
const slug = params.get("slug");

// **Global function for Google Maps callback**
function initTripGallery() {
    fetch(SCRIPT_URL)
        .then(res => res.json())
        .then(data => {
            const trip = data.cardItems.find(t => t.title.toLowerCase().replace(/\s+/g,'-') === slug);
            if(!trip){
                document.getElementById("trip-title").innerText = "Trip not found";
                return;
            }

            // Title
            document.getElementById("trip-title").innerText = trip.title;

            // Trip info
            document.getElementById("trip-info").innerHTML = `
                <p><strong>Date:</strong> ${trip.date}</p>
                <p><strong>Area:</strong> ${trip.area}</p>
                <p><strong>Miles:</strong> ${trip.miles}</p>
                <p><strong>Elevation Gain:</strong> ${trip.elevationGain}</p>
                <p><strong>Type:</strong> ${trip.type}</p>
            `;

            // Cover photo from imageUrl (first photo)
            const firstPhoto = trip.imageUrl ? trip.imageUrl.split(",")[0].trim() : "";
            if(firstPhoto){
                document.getElementById("trip-cover").innerHTML = `<img src="${firstPhoto}" alt="${trip.title}" loading="lazy">`;
            }

            // Small map
            const mapDiv = document.getElementById("trip-map");
            const map = new google.maps.Map(mapDiv, {
                center: { lat: trip.position.lat, lng: trip.position.lng },
                zoom: 10,
                mapTypeId: google.maps.MapTypeId.TERRAIN,
                disableDefaultUI: true,
                gestureHandling: "greedy"
            });
            new google.maps.Marker({
                position: { lat: trip.position.lat, lng: trip.position.lng },
                map: map
            });

      // All photos from Imagefolder column
if(trip.Imagefolder){
    const urls = trip.Imagefolder.split(", "); // split on comma + space
    document.getElementById("photos-container").innerHTML =
        urls.map(u => `<img src="${u}" alt="${trip.title}" loading="lazy">`).join("");
}

        })
        .catch(err => {
            console.error(err);
            document.getElementById("trip-title").innerText = "Failed to load trip data";
        });
}

// Dynamically load Google Maps
(function loadGoogleMaps(){
    const script = document.createElement('script');
    script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyCMCxxUBxZ-a2UyHwu5PbKwYBxvAo0bAAA&callback=initTripGallery";
    script.defer = true;
    document.head.appendChild(script);
})();
</script>

</body>
</html>
